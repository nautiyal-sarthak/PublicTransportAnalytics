{"paragraphs":[{"title":"Imports","text":"import org.apache.spark.sql.SparkSession\nimport org.apache.spark.sql.functions.udf\nimport org.apache.spark.sql.expressions.Window\n\nimport java.time._\nimport java.time.format.DateTimeFormatter\nimport java.text.SimpleDateFormat\n\n","user":"anonymous","dateUpdated":"2018-07-09T02:19:31+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala","tableHide":true,"editorHide":true,"title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import org.apache.spark.sql.SparkSession\nimport org.apache.spark.sql.functions.udf\nimport org.apache.spark.sql.expressions.Window\nimport java.time._\nimport java.time.format.DateTimeFormatter\nimport java.text.SimpleDateFormat\n"}]},"apps":[],"jobName":"paragraph_1530190137151_2027113885","id":"20180628-124857_350319991","dateCreated":"2018-06-28T12:48:57+0000","dateStarted":"2018-07-09T02:19:31+0000","dateFinished":"2018-07-09T02:19:32+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:2720"},{"title":"Data Pre-Processing","text":"val spark = SparkSession.builder.getOrCreate()\nimport spark.implicits._\nval data = spark.read.option(\"header\", \"true\").option(\"inferschema\", \"true\").csv(\"/resources/data/BUs_data.csv\")\ndata.na.drop()\n\ndef createDateTime(dt:String,time:String):(String,String,String,String,String,String) = {\n\ntry{\n    var date = dt\n    if(date.length() > 10){\n      date = date.split(\" \")(0)\n    }\n    val dateTime_value = date + \" \" + time\n\n    val datetime_format = DateTimeFormatter.ofPattern(\"yyyy-MM-dd HH:mm:ss\")\n    val day_format = DateTimeFormatter.ofPattern(\"dd\")\n    val month_format = DateTimeFormatter.ofPattern(\"MM\")\n    val year_format = DateTimeFormatter.ofPattern(\"yyyy\")\n    val hour_format = DateTimeFormatter.ofPattern(\"HH\")\n    val day_of_week_format = DateTimeFormatter.ofPattern(\"EEE\")\n    \n    val string_to_date = datetime_format.parse(dateTime_value)\n    \n    val date_time = datetime_format.format(string_to_date)\n    val day = day_format.format(string_to_date)\n    val month = month_format.format(string_to_date)\n    val year = year_format.format(string_to_date)\n    val hour = hour_format.format(string_to_date)\n    val day_of_week = day_of_week_format.format(string_to_date)\n    \n    (day,month,year,hour,day_of_week,date_time)\n} catch {\n     case e: Exception => (\"0\",\"0\",\"0\",\"0\",\"0\",\"0\")\n   }\n}\n\nval createDateTimeUDF = udf(createDateTime(_:String,_:String))\n\n\nval updatedData = data.withColumn(\"start_dt_formated\",createDateTimeUDF($\"RIDE_START_DATE\",$\"RIDE_START_TIME\")).withColumn(\"end_dt_formated\",createDateTimeUDF($\"RIDE_END_DATE\",$\"RIDE_END_TIME\")).withColumn(\"start_day\",$\"start_dt_formated._1\").withColumn(\"Start_month\",$\"start_dt_formated._2\").withColumn(\"Start_year\",$\"start_dt_formated._3\").withColumn(\"Start_hour\",$\"start_dt_formated._4\").withColumn(\"Start_dow\",$\"start_dt_formated._5\").withColumn(\"start_datetime\",$\"start_dt_formated._6\").withColumn(\"end_day\",$\"end_dt_formated._1\").withColumn(\"end_month\",$\"end_dt_formated._2\").withColumn(\"end_year\",$\"end_dt_formated._3\").withColumn(\"end_hour\",$\"end_dt_formated._4\").withColumn(\"end_dow\",$\"end_dt_formated._5\").withColumn(\"end_datetime\",$\"end_dt_formated._6\").drop(\"start_dt_formated\").drop(\"end_dt_formated\")\n\n\nvar processed_data = updatedData.select($\"ACTUAL_SRVC_NUMBER\",$\"BOARDING_STOP_STN\",$\"ALIGHTING_STOP_STN\",$\"start_datetime\",$\"start_day\",$\"Start_month\",$\"Start_year\",$\"Start_hour\",$\"Start_dow\",$\"end_datetime\",$\"end_day\",$\"end_month\",$\"end_year\",$\"end_hour\",$\"end_dow\")\n\n\nprocessed_data = processed_data.filter(x => !x.anyNull)\nprocessed_data.cache()","user":"anonymous","dateUpdated":"2018-07-09T02:19:31+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala","title":true,"tableHide":true,"editorHide":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"spark: org.apache.spark.sql.SparkSession = org.apache.spark.sql.SparkSession@3d1bfd79\nimport spark.implicits._\ndata: org.apache.spark.sql.DataFrame = [CARD_ID: int, ACTUAL_SRVC_NUMBER: string ... 6 more fields]\nres392: org.apache.spark.sql.DataFrame = [CARD_ID: int, ACTUAL_SRVC_NUMBER: string ... 6 more fields]\ncreateDateTime: (dt: String, time: String)(String, String, String, String, String, String)\ncreateDateTimeUDF: org.apache.spark.sql.expressions.UserDefinedFunction = UserDefinedFunction(<function2>,StructType(StructField(_1,StringType,true), StructField(_2,StringType,true), StructField(_3,StringType,true), StructField(_4,StringType,true), StructField(_5,StringType,true), StructField(_6,StringType,true)),Some(List(StringType, StringType)))\nupdatedData: org.apache.spark.sql.DataFrame = [CARD_ID: int, ACTUAL_SRVC_NUMBER: string ... 18 more fields]\nprocessed_data: org.apache.spark.sql.DataFrame = [ACTUAL_SRVC_NUMBER: string, BOARDING_STOP_STN: string ... 13 more fields]\nprocessed_data: org.apache.spark.sql.DataFrame = [ACTUAL_SRVC_NUMBER: string, BOARDING_STOP_STN: string ... 13 more fields]\nres401: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [ACTUAL_SRVC_NUMBER: string, BOARDING_STOP_STN: string ... 13 more fields]\n"}]},"apps":[],"jobName":"paragraph_1530456119066_-1931944410","id":"20180701-144159_1513787822","dateCreated":"2018-07-01T14:41:59+0000","dateStarted":"2018-07-09T02:19:32+0000","dateFinished":"2018-07-09T02:19:35+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2721"},{"title":"Schema","text":"processed_data.printSchema","user":"anonymous","dateUpdated":"2018-07-09T02:19:31+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala","title":true,"editorHide":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"root\n |-- ACTUAL_SRVC_NUMBER: string (nullable = true)\n |-- BOARDING_STOP_STN: string (nullable = true)\n |-- ALIGHTING_STOP_STN: string (nullable = true)\n |-- start_datetime: string (nullable = true)\n |-- start_day: string (nullable = true)\n |-- Start_month: string (nullable = true)\n |-- Start_year: string (nullable = true)\n |-- Start_hour: string (nullable = true)\n |-- Start_dow: string (nullable = true)\n |-- end_datetime: string (nullable = true)\n |-- end_day: string (nullable = true)\n |-- end_month: string (nullable = true)\n |-- end_year: string (nullable = true)\n |-- end_hour: string (nullable = true)\n |-- end_dow: string (nullable = true)\n\n"}]},"apps":[],"jobName":"paragraph_1530583244627_-796228360","id":"20180703-020044_357258981","dateCreated":"2018-07-03T02:00:44+0000","dateStarted":"2018-07-09T02:19:32+0000","dateFinished":"2018-07-09T02:19:35+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2722"},{"title":"Setting Global Variables","text":"val All_buss = processed_data.select($\"ACTUAL_SRVC_NUMBER\").distinct().map(r => (r.getString(0),r.getString(0))).collect.toList.sortBy(x => x._1)\n\nval All_stops = processed_data.select($\"BOARDING_STOP_STN\").unionAll(processed_data.select($\"ALIGHTING_STOP_STN\")).distinct().map(r => (r.getString(0),r.getString(0))).collect.toList.sortBy(x => x._1)\nval timeLst = List(\n                    (\"start_day\",\"Daily\"),\n                    (\"Start_month\",\"Monthly\"),\n                    (\"Start_year\",\"Yearly\"),\n                    (\"Start_hour\",\"Per Hour\"),\n                    (\"Start_dow\",\"day of Week\")\n                )\n                ","user":"anonymous","dateUpdated":"2018-07-09T02:19:31+0000","config":{"colWidth":12,"enabled":true,"results":{"0":{"graph":{"mode":"table","height":244,"optionOpen":false}}},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala","runOnSelectionChange":true,"editorHide":true,"tableHide":false,"title":true},"settings":{"params":{"day":"","bussno":"282"},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"All_buss: List[(String, String)] = List((Bus 1,Bus 1))\nwarning: there was one deprecation warning; re-run with -deprecation for details\nAll_stops: List[(String, String)] = List((Office,Office), (Residential,Residential), (School,School))\ntimeLst: List[(String, String)] = List((start_day,Daily), (Start_month,Monthly), (Start_year,Yearly), (Start_hour,Per Hour), (Start_dow,day of Week))\n"}]},"apps":[],"jobName":"paragraph_1530575186502_-1006957958","id":"20180702-234626_1620069012","dateCreated":"2018-07-02T23:46:26+0000","dateStarted":"2018-07-09T02:19:35+0000","dateFinished":"2018-07-09T02:19:37+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2723"},{"title":"Bus Ridership per Time Frame ","text":"var bus_no = z.select(\"Select the Buss Number:\", All_buss)\nvar timeWindow = z.select(\"Time Range:\", timeLst)\nvar tf = processed_data.filter($\"ACTUAL_SRVC_NUMBER\" === bus_no).groupBy(timeWindow.toString()).count()\n\nz.show(tf.select(tf(timeWindow.toString()).alias(\"Time\"),$\"count\"))\n","user":"anonymous","dateUpdated":"2018-07-09T02:19:31+0000","config":{"colWidth":12,"enabled":true,"results":{"0":{"graph":{"mode":"multiBarChart","height":300,"optionOpen":false,"setting":{"multiBarChart":{"stacked":false}},"commonSetting":{},"keys":[{"name":"start_dow","index":0,"aggr":"sum"}],"groups":[],"values":[{"name":"count","index":1,"aggr":"sum"}]},"helium":{}},"1":{"graph":{"mode":"multiBarChart","height":228,"optionOpen":false,"setting":{"multiBarChart":{"stacked":false}},"commonSetting":{},"keys":[{"name":"Time","index":0,"aggr":"sum"}],"groups":[],"values":[{"name":"count","index":1,"aggr":"sum"}]},"helium":{}}},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala","title":true,"runOnSelectionChange":false,"editorHide":false,"tableHide":false},"settings":{"params":{"bussno":"112","time":"Start_dow","Select the Buss Number:":"Bus 1","Time Range:":"Start_hour"},"forms":{"Select the Buss Number:":{"name":"Select the Buss Number:","displayName":"Select the Buss Number:","type":"select","defaultValue":"","options":[{"value":"Bus 1","displayName":"Bus 1","$$hashKey":"object:3222"}],"hidden":false,"$$hashKey":"object:3211"},"Time Range:":{"name":"Time Range:","displayName":"Time Range:","type":"select","defaultValue":"","options":[{"value":"start_day","displayName":"Daily","$$hashKey":"object:3227"},{"value":"Start_month","displayName":"Monthly","$$hashKey":"object:3228"},{"value":"Start_year","displayName":"Yearly","$$hashKey":"object:3229"},{"value":"Start_hour","displayName":"Per Hour","$$hashKey":"object:3230"},{"value":"Start_dow","displayName":"day of Week","$$hashKey":"object:3231"}],"hidden":false,"$$hashKey":"object:3212"}}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"bus_no: Object = Bus 1\ntimeWindow: Object = Start_hour\ntf: org.apache.spark.sql.DataFrame = [Start_hour: string, count: bigint]\n"},{"type":"TABLE","data":"Time\tcount\n09\t2\n08\t111\n"}]},"apps":[],"jobName":"paragraph_1530581464676_-1181486247","id":"20180703-013104_1733279150","dateCreated":"2018-07-03T01:31:04+0000","dateStarted":"2018-07-09T02:19:35+0000","dateFinished":"2018-07-09T02:19:38+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2724"},{"title":"Number of customers BOARDING and ALIGHTING at diffrent Bus Stops for a perticular bus for a given time range","text":"bus_no = z.select(\"Select the Buss Number:\", All_buss)\n\nvar min_start = processed_data.filter($\"ACTUAL_SRVC_NUMBER\" === bus_no).select($\"start_datetime\").orderBy(\"start_datetime\").take(1)(0)(0).asInstanceOf[String]\nvar max_end = processed_data.filter($\"ACTUAL_SRVC_NUMBER\" === bus_no).select($\"end_datetime\").orderBy(desc(\"end_datetime\")).take(1)(0)(0).asInstanceOf[String]\n\nvar startTime = z.input(\"From date\",min_start)\nvar endTime = z.input(\"To date\",max_end)\n\nval sds = new SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\")\nval min_dt = sds.parse(startTime.toString)\nval max_dt = sds.parse(endTime.toString)\n\nprintln(min_dt.compareTo(max_dt))\n\nmin_dt.compareTo(max_dt) match{\n    case -1 => {\n\n        val filteredData = processed_data.filter($\"start_datetime\" > startTime and $\"end_datetime\" < endTime)\n        val board = filteredData.filter($\"ACTUAL_SRVC_NUMBER\" === bus_no).groupBy(\"BOARDING_STOP_STN\").count().withColumn(\"Status\",lit(\"BOARDING\"))\n        val alighting = filteredData.filter($\"ACTUAL_SRVC_NUMBER\" === bus_no).groupBy(\"ALIGHTING_STOP_STN\").count().withColumn(\"processed\",$\"count\" * -1).drop(\"count\").withColumn(\"Status\",lit(\"ALIGHTING\"))\n        z.show(board.unionAll(alighting))\n    }\n    case _ => {println(\"start date should be less than the end date\")}\n    }\n    ","user":"anonymous","dateUpdated":"2018-07-09T02:19:31+0000","config":{"colWidth":12,"enabled":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":true,"setting":{"multiBarChart":{"stacked":false}},"commonSetting":{},"keys":[{"name":"BOARDING_STOP_STN","index":0,"aggr":"sum"}],"groups":[],"values":[{"name":"count","index":1,"aggr":"sum"}]},"helium":{}},"1":{"graph":{"mode":"multiBarChart","height":300,"optionOpen":false,"setting":{"multiBarChart":{"stacked":true}},"commonSetting":{},"keys":[{"name":"BOARDING_STOP_STN","index":0,"aggr":"sum"}],"groups":[{"name":"Status","index":2,"aggr":"sum"}],"values":[{"name":"count","index":1,"aggr":"sum"}]},"helium":{}}},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala","tableHide":false,"editorHide":true,"title":true,"runOnSelectionChange":true},"settings":{"params":{"Start Date Time":"sun","End Date Time":"sun","test":"dfa","tes":"min_start","te":{"schema":{"fields":[{"name":"start_datetime","dataType":{"ordering":{}},"nullable":true,"metadata":{"map":{},"_hashCode":-1609326920,"bitmap$0":true}}],"_hashCode":-1091774535,"bitmap$0":8},"values":["Feb 15, 2016 6:02:42 AM"]},"tet":"[2016-02-15 06:02:42.0]","date from :":"[2016-02-15 06:02:42.0]","date to :":"[2016-02-21 23:56:47.0]","date from":"Feb 15, 2016 12:18:29 AM","date to":"Feb 22, 2016 12:02:09 AM","date from ::":"2016-02-15 00:18:29","From date":"2018-01-01 07:00:59","To date":"2018-01-02 09:00:59","Select the Buss Number:":"Bus 1","Time Range:":""},"forms":{"Select the Buss Number:":{"name":"Select the Buss Number:","displayName":"Select the Buss Number:","type":"select","defaultValue":"","options":[{"value":"Bus 1","displayName":"Bus 1","$$hashKey":"object:3335"}],"hidden":false,"$$hashKey":"object:3321"},"From date":{"name":"From date","displayName":"From date","type":"input","defaultValue":"2018-01-01 08:00:54","hidden":false,"$$hashKey":"object:3322"},"To date":{"name":"To date","displayName":"To date","type":"input","defaultValue":"2018-01-01 09:30:11","hidden":false,"$$hashKey":"object:3323"}}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"bus_no: Object = Bus 1\nmin_start: String = 2018-01-01 08:00:54\nmax_end: String = 2018-01-01 09:30:11\nstartTime: Object = 2018-01-01 07:00:59\nendTime: Object = 2018-01-02 09:00:59\nsds: java.text.SimpleDateFormat = java.text.SimpleDateFormat@4f76f1a0\nmin_dt: java.util.Date = Mon Jan 01 07:00:59 UTC 2018\nmax_dt: java.util.Date = Tue Jan 02 09:00:59 UTC 2018\n-1\nwarning: there was one deprecation warning; re-run with -deprecation for details\n"},{"type":"TABLE","data":"BOARDING_STOP_STN\tcount\tStatus\nResidential\t113\tBOARDING\nOffice\t-38\tALIGHTING\nSchool\t-75\tALIGHTING\n"}]},"apps":[],"jobName":"paragraph_1530583293719_680715398","id":"20180703-020133_45517236","dateCreated":"2018-07-03T02:01:33+0000","dateStarted":"2018-07-09T02:19:37+0000","dateFinished":"2018-07-09T02:19:41+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2725"},{"title":"For a particular BusStop , the trend of bus usage","text":"var stop_no = z.select(\"Select the Stop number:\", All_stops)\nvar related_bus = processed_data.select($\"ACTUAL_SRVC_NUMBER\").filter($\"BOARDING_STOP_STN\" === stop_no).unionAll(processed_data.select($\"ACTUAL_SRVC_NUMBER\").filter($\"ALIGHTING_STOP_STN\" === stop_no)).distinct().map(r => (r.getString(0),r.getString(0))).collect.toList.sortBy(x => x._1)\n\nvar timeWindow = z.select(\"Time Range:\", timeLst)\nvar bus = z.checkbox(\"Buses\", related_bus)\n\nval stop_board = processed_data.filter($\"BOARDING_STOP_STN\" === stop_no).select($\"ACTUAL_SRVC_NUMBER\",processed_data(timeWindow.toString).alias(\"time\")).withColumn(\"Status\",lit(\"BOARDING\")).withColumn(\"count\",lit(1))\n\n\nval stop_alig = processed_data.filter($\"ALIGHTING_STOP_STN\" === stop_no).select($\"ACTUAL_SRVC_NUMBER\",processed_data(timeWindow.toString).alias(\"time\")).withColumn(\"Status\",lit(\"ALIGHTING\")).withColumn(\"count\",lit(-1))\n\nval stop_union = stop_board.unionAll(stop_alig)\n\nz.show(stop_union.filter($\"ACTUAL_SRVC_NUMBER\".isin(bus.toList:_*)).groupBy($\"ACTUAL_SRVC_NUMBER\",$\"Status\",$\"time\").sum(\"count\"))\n\n","user":"anonymous","dateUpdated":"2018-07-09T02:19:31+0000","config":{"colWidth":12,"enabled":true,"results":{"1":{"graph":{"mode":"multiBarChart","height":392,"optionOpen":false,"setting":{"lineChart":{"forceY":false,"lineWithFocus":false},"multiBarChart":{"stacked":false}},"commonSetting":{},"keys":[{"name":"time","index":2,"aggr":"sum"}],"groups":[{"name":"ACTUAL_SRVC_NUMBER","index":0,"aggr":"sum"},{"name":"Status","index":1,"aggr":"sum"}],"values":[{"name":"sum(count)","index":3,"aggr":"sum"}]},"helium":{}}},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala","title":true,"editorHide":true,"runOnSelectionChange":true},"settings":{"params":{"Select the Stop number:":"Residential","fruit":["147","196","197","961","961C"],"Buses":["147","197","961","Bus 1"],"Time Range:":"Start_hour"},"forms":{"Select the Stop number:":{"name":"Select the Stop number:","displayName":"Select the Stop number:","type":"select","defaultValue":"","options":[{"value":"Office","displayName":"Office","$$hashKey":"object:3449"},{"value":"Residential","displayName":"Residential","$$hashKey":"object:3450"},{"value":"School","displayName":"School","$$hashKey":"object:3451"}],"hidden":false,"$$hashKey":"object:3435"},"Time Range:":{"name":"Time Range:","displayName":"Time Range:","type":"select","defaultValue":"","options":[{"value":"start_day","displayName":"Daily","$$hashKey":"object:3456"},{"value":"Start_month","displayName":"Monthly","$$hashKey":"object:3457"},{"value":"Start_year","displayName":"Yearly","$$hashKey":"object:3458"},{"value":"Start_hour","displayName":"Per Hour","$$hashKey":"object:3459"},{"value":"Start_dow","displayName":"day of Week","$$hashKey":"object:3460"}],"hidden":false,"$$hashKey":"object:3436"},"Buses":{"name":"Buses","displayName":"Buses","type":"checkbox","defaultValue":["Bus 1"],"options":[{"value":"Bus 1","displayName":"Bus 1","$$hashKey":"object:3465"}],"hidden":false,"$$hashKey":"object:3437"}}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"stop_no: Object = Residential\nwarning: there was one deprecation warning; re-run with -deprecation for details\nrelated_bus: List[(String, String)] = List((Bus 1,Bus 1))\ntimeWindow: Object = Start_hour\nbus: Iterable[Object] = Wrappers(Bus 1)\nstop_board: org.apache.spark.sql.DataFrame = [ACTUAL_SRVC_NUMBER: string, time: string ... 2 more fields]\nstop_alig: org.apache.spark.sql.DataFrame = [ACTUAL_SRVC_NUMBER: string, time: string ... 2 more fields]\nwarning: there was one deprecation warning; re-run with -deprecation for details\nstop_union: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [ACTUAL_SRVC_NUMBER: string, time: string ... 2 more fields]\n"},{"type":"TABLE","data":"ACTUAL_SRVC_NUMBER\tStatus\ttime\tsum(count)\nBus 1\tBOARDING\t09\t2\nBus 1\tBOARDING\t08\t111\n"}]},"apps":[],"jobName":"paragraph_1530620627681_-586710864","id":"20180703-122347_2112088233","dateCreated":"2018-07-03T12:23:47+0000","dateStarted":"2018-07-09T02:19:38+0000","dateFinished":"2018-07-09T02:19:43+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2726"},{"title":"Bus Frequency ","text":"stop_no = z.select(\"Select the Stop number:\", All_stops)\n\nrelated_bus = processed_data.select($\"ACTUAL_SRVC_NUMBER\").filter($\"BOARDING_STOP_STN\" === stop_no).unionAll(processed_data.select($\"ACTUAL_SRVC_NUMBER\").filter($\"ALIGHTING_STOP_STN\" === stop_no)).distinct().map(r => (r.getString(0),r.getString(0))).collect.toList.sortBy(x => x._1)\nbus = z.checkbox(\"Buses\", related_bus)\n\nmin_start = processed_data.filter($\"ACTUAL_SRVC_NUMBER\".isin(bus.toList:_*)).select($\"start_datetime\").orderBy(\"start_datetime\").take(1)(0)(0).asInstanceOf[String]\nmax_end = processed_data.filter($\"ACTUAL_SRVC_NUMBER\".isin(bus.toList:_*)).select($\"end_datetime\").orderBy(desc(\"end_datetime\")).take(1)(0)(0).asInstanceOf[String]\n\nstartTime = z.input(\"From date\",min_start)\nendTime = z.input(\"To date\",max_end)\n\nval filtered_data = processed_data.filter($\"start_datetime\" > startTime and $\"end_datetime\" < endTime)\n\nval stop_board = filtered_data.filter($\"BOARDING_STOP_STN\" === stop_no).select($\"ACTUAL_SRVC_NUMBER\",$\"start_datetime\")\nval stop_alig = filtered_data.filter($\"ALIGHTING_STOP_STN\" === stop_no).select($\"ACTUAL_SRVC_NUMBER\",$\"end_datetime\")\nval frq_union = stop_board.union(stop_alig)\nval fre_data = frq_union.filter($\"ACTUAL_SRVC_NUMBER\".isin(bus.toList:_*)).sort(\"start_datetime\").withColumn(\"timestamp\",unix_timestamp($\"start_datetime\", \"yyyy-MM-dd HH:mm:ss\"))\n\n\nval wSpec = Window.partitionBy($\"ACTUAL_SRVC_NUMBER\").orderBy($\"timestamp\").rangeBetween(-60, 60)\nval d1 = fre_data.withColumn(\"out\", max($\"timestamp\").over(wSpec)).groupBy($\"ACTUAL_SRVC_NUMBER\",$\"out\").count()\n\nval wSpec2 = Window.partitionBy($\"ACTUAL_SRVC_NUMBER\").orderBy($\"out\").rowsBetween(-1, 1)\nz.show(d1.withColumn(\"diff\", (max($\"out\").over(wSpec2) - min($\"out\").over(wSpec2))/60).groupBy($\"ACTUAL_SRVC_NUMBER\").mean(\"diff\"))\n\n\n","user":"anonymous","dateUpdated":"2018-07-09T02:19:32+0000","config":{"colWidth":12,"enabled":true,"results":{"0":{"graph":{"mode":"table","height":92,"optionOpen":false}},"1":{"graph":{"mode":"multiBarChart","height":446,"optionOpen":false},"helium":{}}},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala","title":true,"runOnSelectionChange":false,"editorHide":true},"settings":{"params":{"Select the Stop number:":"Residential","Buses":["147","197","61","122","170","105","972","190","9","Bus 1"],"From date":"2016-02-15 00:03:02","To date":"2018-02-22 00:34:32"},"forms":{"Select the Stop number:":{"name":"Select the Stop number:","displayName":"Select the Stop number:","type":"select","defaultValue":"","options":[{"value":"Office","displayName":"Office","$$hashKey":"object:3574"},{"value":"Residential","displayName":"Residential","$$hashKey":"object:3575"},{"value":"School","displayName":"School","$$hashKey":"object:3576"}],"hidden":false,"$$hashKey":"object:3557"},"Buses":{"name":"Buses","displayName":"Buses","type":"checkbox","defaultValue":["Bus 1"],"options":[{"value":"Bus 1","displayName":"Bus 1","$$hashKey":"object:3581"}],"hidden":false,"$$hashKey":"object:3558"},"From date":{"name":"From date","displayName":"From date","type":"input","defaultValue":"2018-01-01 08:00:54","hidden":false,"$$hashKey":"object:3559"},"To date":{"name":"To date","displayName":"To date","type":"input","defaultValue":"2018-01-01 09:30:11","hidden":false,"$$hashKey":"object:3560"}}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"stop_no: Object = Residential\nwarning: there was one deprecation warning; re-run with -deprecation for details\nrelated_bus: List[(String, String)] = List((Bus 1,Bus 1))\nbus: Iterable[Object] = Wrappers(Bus 1)\nmin_start: String = 2018-01-01 08:00:54\nmax_end: String = 2018-01-01 09:30:11\nstartTime: Object = 2016-02-15 00:03:02\nendTime: Object = 2018-02-22 00:34:32\nfiltered_data: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [ACTUAL_SRVC_NUMBER: string, BOARDING_STOP_STN: string ... 13 more fields]\nstop_board: org.apache.spark.sql.DataFrame = [ACTUAL_SRVC_NUMBER: string, start_datetime: string]\nstop_alig: org.apache.spark.sql.DataFrame = [ACTUAL_SRVC_NUMBER: string, end_datetime: string]\nfrq_union: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [ACTUAL_SRVC_NUMBER: string, start_datetime: string]\nfre_data: org.apache.spark.sql.DataFrame = [ACTUAL_SRVC_NUMBER: string, start_datetime: string ... 1 more field]\nwSpec: org.apache.spark.sql.expressions.WindowSpec = org.apache.spark.sql.expressions.WindowSpec@75f16777\nd1: org.apache.spark.sql.DataFrame = [ACTUAL_SRVC_NUMBER: string, out: bigint ... 1 more field]\nwSpec2: org.apache.spark.sql.expressions.WindowSpec = org.apache.spark.sql.expressions.WindowSpec@32bf60dd\n"},{"type":"TABLE","data":"ACTUAL_SRVC_NUMBER\tavg(diff)\nBus 1\t16.914285714285715\n"}]},"apps":[],"jobName":"paragraph_1530621992169_1033031623","id":"20180703-124632_1795283960","dateCreated":"2018-07-03T12:46:32+0000","dateStarted":"2018-07-09T02:19:41+0000","dateFinished":"2018-07-09T02:19:48+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2727"},{"user":"anonymous","dateUpdated":"2018-07-09T02:19:32+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1531101715634_-104050363","id":"20180709-020155_1489454349","dateCreated":"2018-07-09T02:01:55+0000","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:2728"}],"name":"bus_tracker","id":"2DJTBN3CS","angularObjects":{"2C1FSWPV5:shared_process":[],"2C2ANMC3H:shared_process":[],"2C27C2CAW:shared_process":[],"2C1EQ4DYT:shared_process":[],"2C2D85D6Q:shared_process":[],"2BYMYHYE7:shared_process":[],"2BZJ3HWCJ:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}